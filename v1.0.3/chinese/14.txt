14 B类MAC命令
A类规范中描述的所有命令都应在B类设备中实现。 B类规范添加了以下MAC命令。

14.1 PingSlotInfoReq

使用PingSlotInfoReq命令，终端设备通知服务器其单播ping时隙周期。 此命令仅可用于通知服务器UNICAST ping槽的周期。 组播槽完全由应用程序定义，不应使用此命令。

周期性子字段是无符号3比特整数，其使用以下等式对终端设备当前使用的ping时隙周期进行编码。

实际的ping槽周期将以秒为单位等于XXXXXX

•Periodicity = 0表示终端设备在beacon_window间隔期间大约每秒打开一个ping槽

•周期性= 7，每128秒，这是LoRaWAN B类规范支持的最大ping周期。

要更改其ping槽周期，设备应首先恢复为A类，通过PingSlotInfoReq命令发送新周期，并通过PingSlotInfoAns从服务器获取确认。 然后它可以用新的周期切换回B类。 此命令可以与FHDRFOpt字段中的任何其他MAC命令连接，如A类规范帧格式中所述。

14.2 BeaconFreqReq
该命令由服务器发送到终端设备，以修改该终端设备期望信标的频率。

频率编码与A类中定义的NewChannelReq MAC命令相同。

频率是24位无符号整数。 以Hz为单位的实际信标信道频率为100 x frequ。 这允许将信标信道定义在100MHz到1.67GHz之间的任何地方，步长为100Hz。 终端设备必须检查其无线电硬件实际允许的频率，否则返回错误。

即使默认行为指定跳频信标（即US ISM频带），有效的非零频率也将迫使设备在固定频率信道上监听信标。

值0指示终端设备使用“信标物理层”部分中定义的默认信标频率规划。 在适用的情况下，设备恢复跳频信标搜索。

在接收到该命令后，终端设备用BeaconFreqAns消息应答。 此消息的MAC有效负载包含以下信息：

14.3 PingSlotChannelReq
该命令由服务器发送到终端设备，以修改终端设备期望下行链路ping的频率和/或数据速率。

此命令只能在A类接收窗口中发送（在上行链路之后）。 该命令不应在B类ping槽中发送。 如果设备在B类ping槽内接收到它，则不应处理MAC命令。 一旦NS发送了第一个PingSlotChannelReq命令，它应该重新发送它，直到它从设备接收到PingSlotChannelAns。 在收到PingSlotChannelAns之前，它不得尝试使用B类ping槽。

频率编码与A类中定义的NewChannelReq MAC命令相同。

频率是24位无符号整数。 以Hz为单位的实际ping通道频率为100 x frequ。 这允许通过100Hz步长在100MHz至1.67GHz之间的任何地方定义ping通道。 终端设备必须检查其无线电硬件实际允许的频率，否则返回错误。

值0指示终端设备使用默认频率规划。 在适用的情况下，设备恢复跳频信标搜索。

DR字节包含以下字段：

“数据速率”子字段是用于ping时隙下行链路的数据速率的索引。 索引和物理数据速率之间的关系在[PHY]中为每个区域定义。

收到此命令后，终端设备将使用PingSlotFreqAns消息进行应答。 此消息的MAC有效负载包含以下信息：

如果这两个位中的任何一个等于0，则命令不成功并且ping时隙参数未被修改。

14.4 BeaconTimingReq和BeaconTimingAns

这些MAC命令在LoRaWAN1.0.3版本中已弃用。 设备可以使用DeviceTimeReq和Ans命令作为替代。