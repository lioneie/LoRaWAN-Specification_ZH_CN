
对于支持B类终端设备的网络，所有网关必须同步广播信标，为终端设备提供定时参考。 基于该定时参考，终端设备可以周期性地打开接收窗口，此后称为“ping时隙”，其可以由网络基础设施用于发起下行链路通信。 使用这些ping时隙之一的网络发起的下行链路称为“ping”。 选择用于发起该下行链路通信的网关由网络服务器基于终端设备的最后一个上行链路的信号质量指示符来选择。 由于这个原因，如果终端设备移动并检测到在接收到的信标中通告的身份的变化，它必须向网络服务器发送上行链路，以便服务器可以更新下行链路路由路径数据库。

在设备可以在B类模式下运行之前，必须为带外网络服务器提供以下信息。
设备的默认ping时隙周期
默认Ping插槽数据速率
默认Ping-slot通道

所有终端设备都作为A类终端设备启动并加入网络。然后，终端设备应用程序可以决定切换到B类。这可以通过以下过程完成：

终端设备应用程序请求LoRaWAN层切换到B类模式。 终端设备中的LoRaWAN层搜索信标，如果找到并锁定了网络信标，则向应用程序返回BEACON_LOCKED服务原语，或者返回BEACON_NOT_FOUND服务原语。 为了加速信标发现，LoRaWAN层可以使用“DeviceTimeReq”MAC命令。

一旦处于B类模式，MAC层将发送的每个上行链路帧的FCTRL字段的B类比特设置为1。 该位向服务器发信号通知该设备已切换到B类.MAC层将自主地为每个信标和每个ping时隙调度接收时隙。 当信标接收成功时，终端设备LoRaWAN层将信标内容与测量的无线电信号强度一起转发到应用。 终端设备LoRaWAN层考虑了信标接收时隙和ping时隙的调度中的最大可能时钟漂移。 当在ping时隙期间成功解调下行链路时，其与下行链路类似地处理，如LoRaWAN A类规范中所述。

移动终端设备必须定期通知网络服务器其位置以更新下行链路路由。 这是通过发送正常（可能为空）“未确认”或“已确认”上行链路来完成的。 终端设备LoRaWAN层将在帧的FCtrl字段中将B类位适当地设置为1。 最佳地，如果应用通过分析信标内容检测到节点正在移动，则可以更有效地完成此操作。 在这种情况下，终端设备必须在信标接收和上行链路传输之间应用随机延迟（如第15.5节中所定义），以避免系统的上行链路冲突。

网络服务器可以随时通过发送PingSlotChannelReq MAC命令来更改设备的ping时隙下行链路频率或数据速率。

设备可以随时改变其ping时隙的周期性。 为此，它必须暂时停止B类操作（在其上行链路帧中取消设置classB位）并将PingSlotInfoReq发送到网络服务器。 一旦确认该命令，设备就可以用新的ping时隙周期重启classB操作

如果在给定时间段内未收到信标（如第12.2节中所定义），则与网络的同步将丢失。 MAC层必须通知应用层它已切换回A类。因此，终端设备LoRaWAN层停止在所有上行链路中设置B类位，这会通知网络服务器终端设备不再存在 B类模式。 终端设备应用程序可以尝试定期切换回B类。 这将从信标搜索开始重新启动此过程。

下图说明了信标接收时隙和ping时隙的概念。

在该示例中，假设信标周期是128秒，终端设备还每32秒打开一个ping接收时隙。 大多数情况下，该ping时隙不被服务器使用，因此一旦无线电收发器已经评估无线电信道上不存在前导码，则终端设备接收窗口关闭。 如果检测到前导码，则无线电收发器将保持开启直到解调下行链路帧。 然后，MAC层将处理该帧，检查其地址字段是否与终端设备地址匹配，并且在将其转发到应用层之前，消息完整性检查是有效的。
